# Entity Relationship Diagram (ERD)

This diagram illustrates the relationships between the main entities in the database. It is represented using [Mermaid](https://mermaid.js.org/) syntax.

You can render this diagram using tools that support Mermaid, such as many Markdown editors, or online viewers.

```mermaid
erDiagram
    User ||--o{ Role_User : "has"
    Role ||--o{ Role_User : "belongs to"
    Role ||--o{ Role_Menu : "grants access to"
    Menu ||--o{ Role_Menu : "is granted by"
    Role ||--o{ Role_Api : "authorizes"
    Api ||--o{ Role_Api : "is authorized by"

    User {
        bigint id PK
        varchar username UK "사용자 이름"
        varchar alias "이름"
        varchar email UK "이메일"
        varchar phone "전화번호"
        varchar password "비밀번호"
        bool is_active "활성화 여부"
        bool is_superuser "슈퍼 관리자 여부"
        datetime last_login "마지막 로그인 시간"
        int dept_id FK "부서 ID"
        datetime created_at
        datetime updated_at
    }

    Role {
        bigint id PK
        varchar name UK "역할 이름"
        varchar desc "역할 설명"
        datetime created_at
        datetime updated_at
    }

    Api {
        bigint id PK
        varchar path "API 경로"
        varchar method "MethodType (enum)"
        varchar summary "요청 요약"
        varchar tags "API 태그"
        datetime created_at
        datetime updated_at
    }

    Menu {
        bigint id PK
        varchar name "메뉴 이름"
        json remark "예약 필드"
        varchar menu_type "MenuType (enum)"
        varchar icon "메뉴 아이콘"
        varchar path "메뉴 경로"
        int order "정렬"
        int parent_id FK "상위 메뉴 ID (self-ref)"
        bool is_hidden "숨김 여부"
        varchar component "컴포넌트"
        bool keepalive "활성 상태"
        varchar redirect "리디렉션"
        datetime created_at
        datetime updated_at
    }

    Dept {
        bigint id PK
        varchar name UK "부서 이름"
        varchar desc "비고"
        bool is_deleted "소프트 삭제 플래그"
        int order "정렬"
        int parent_id FK "상위 부서 ID (self-ref)"
        datetime created_at
        datetime updated_at
    }

    DeptClosure {
        bigint id PK
        int ancestor "상위 항목 ID (FK to Dept)"
        int descendant "하위 항목 ID (FK to Dept)"
        int level "깊이"
        datetime created_at
        datetime updated_at
    }

    AuditLog {
        bigint id PK
        int user_id "사용자 ID"
        varchar username "사용자 이름"
        varchar module "기능 모듈"
        varchar summary "요청 설명"
        varchar method "요청 방법"
        varchar path "요청 경로"
        int status "상태 코드"
        int response_time "응답 시간(ms)"
        json request_args "요청 매개변수"
        json response_body "반환 데이터"
        datetime created_at
        datetime updated_at
    }

    User }o--|| Dept : "belongs to"
    Menu }o--|| Menu : "parent_of"
    Dept }o--|| Dept : "parent_of"

    DeptClosure }o--|| Dept : "ancestor_is"
    DeptClosure }o--|| Dept : "descendant_is"

    AuditLog }o--|| User : "performed_by"


    %% Implicit Join Tables for Many-to-Many relationships
    %% These are typically auto-generated by Tortoise ORM
    %% but shown here for clarity of relationships.

    Role_User {
        %% bigint user_id PK,FK
        %% bigint role_id PK,FK
        %% Note: Actual join table name might be user_role
    }

    Role_Menu {
        %% bigint role_id PK,FK
        %% bigint menu_id PK,FK
        %% Note: Actual join table name might be role_menu
    }

    Role_Api {
        %% bigint role_id PK,FK
        %% bigint api_id PK,FK
        %% Note: Actual join table name might be role_api
    }

```
**Note on Many-to-Many Join Tables:**
The tables `Role_User`, `Role_Menu`, and `Role_Api` represent the intermediate join tables for the many-to-many relationships. Tortoise ORM typically creates these automatically (e.g., as `user_role`, `menu_role`, `api_role`). Their exact structure (column names) might vary based on ORM conventions but generally consist of foreign keys to the linked tables.
The `DeptClosure` table is used for efficient querying of hierarchical department data (ancestors/descendants).
The `FK` in the diagram indicates a Foreign Key relationship. `UK` indicates a Unique Key.
Field descriptions from the models are included where available.
```
